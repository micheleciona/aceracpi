#summary How to get the extra/ multimedia keys supported
#labels Featured

= Background =

Keys (usually!) generate scan codes. The Linux kernel (in particular, atkbd.c) 
maps the scan codes to keycodes. To be able to map X to the keys, or for them 
to be recognised and do anything useful, you need a keycode.

Standard keys (i.e. the "normal" 104 keys on your keyboard - e.g. A-Z, 0-9, etc) generate standard scancodes which have a standardised mapping to keycodes inside the kernel - so all works well there.

However - many of the extra keys on Acer laptops do _not_ generate standard scancodes - hence you get errors in dmesg as the kernel does not know what keycodes these unknown scancodes should be mapped to.

(Unlike some other laptops though, nearly all the keys on Acer laptops do generate scancodes, so we don't need extra kernel drivers to work them).

= Problem: =

Kernel policy is that this mapping of extra/ unknown keys should _not_ be done in the kernel (or by kernel drivers) - it should be done by user space.

Until recently, there was no 'unified' place to do this - (U/K/X)buntu and SuSE adopted hotkey-setup, other distributions adopted different methods, or none at all. Or in some cases, users had to rely on doing this mapping themselves, leading to more inconsistency.

= Solution =

The [http://hughsient.livejournal.com/29730.html "Unfuck my keyboard"] project aims to move all this keyboard mapping into HAL, since HAL is a far better cross-platform solution to the problem (and since Slackware 12.0 now includes HAL, I (Carlos) am now happy to support such an initiative :-)

HAL will use DMI data (aka ask the BIOS) to find out what your laptop is, then match this to user submitted data to map the scancodes-to-key codes appropriately. This functionality is not yet available in released versions of HAL (it will be in 0.5.10 and newer - there is also regularly updated build of the latest development HAL for Fedora users).

What HAL needs is information from users on which keys to map scancodes to for different laptops.

= What you need to do =

If you've seen enough, you know what I'm doing and want to dive right in 
(aka "Hurt me plenty"), then just go here (In particular, I reccommend looking at the Aspire 5020 as a good template):

http://people.freedesktop.org/~hughsient/quirk/quirk-keymap-index.html

If, on the other hand, you want to help out, but are not really very confident in submitting patches or all this XML stuff (aka "I'm too young to die"), then *I am happy to produce and submit patches to HAL on your behalf*. I will need you to e-mail the following to me (Carlos - cathectic(@)gmail.com):

((U/K/X)buntu and SuSE users: If you have hotkey-setup installed, _please_ disable 
or remove it and then reboot before doing this).

1) Make and model of your laptop.

2) The output of:

dmidecode --string system-manufacturer

dmidecode --string system-product-name

3) And:

A list of all the keys which generate error messages in 'dmesg', and the 
scancode they report (just try all the keys, and all valid Fn+Key 
combinations, and report back those that generate an atkbd.c message in 
dmesg).

Ideally, this should be done in runlevel 3, to stop X or any X daemons from interfering with this. As root:

telinit 3

e.g. On my laptop, pressing the wireless button (with wireless off) produces 
this in dmesg:

atkbd.c: Use 'setkeycodes e056 <keycode>' to make it known.

The scancode I need from you is e056, so you would tell me something like:

wireless button (wireless off) = e056

For example, on my Aspire 5020 I get the following:

  * Fn+F1 = e025
  * Fn+F2 = e026
  * Fn+F3 = e027
  * Fn+F5 = e029
  * Fn+F7 (turn touchpad off) = e072
  * Fn+F7 (turn touchpad back on) = e071
  * Euro sign (the one left of "up" arrow) = e033
  * Dollar sign (the one right of "up" arrow) = e034
  * Acer "e" button = e074
  * Acer "P" button = e073

These next four scancodes might be a bit different on your laptop because the 
on/ off thing may not quite work the same, or the hardware isn't there but 
you have the button (e.g. bluetooth - if the button is there, press it 
anyway):

  * Wireless button (wireless on) = e055
  * Wireless button (wireless off) = e056
  * Bluetooth button (bluetooth on) = e057
  * Bluetooth button (bluetooth off) = e058

(Also, on some newer laptops, apparently Fn+Left/ Right also generate scancodes)

Be aware that:

The wireless and bluetooth buttons will probably report different scancodes 
depending on whether you have enabled the device or not.

Not all keys will generate error messages in dmesg (e.g. on my Aspire 5021, 
the multimedia keys are already mapped to proper keycodes by the kernel, and 
the brightness keys do not emit any scancodes).

= X =

The next step is to map the kernel key codes to X key codes for X (so you can use these keys with your favourite window manager/ desktop environment). For all the extra keys that _don't_ produce an error in dmesg, please run 'xev' in a terminal, whilst running X (e.g. in Konsole). Press the key, and report back to me (Carlos - cathectic(@)gmail.com) the key and its keycode.

e.g. If you pressed the letter g you would get two events (a press and a release):

KeyPress event, serial 31, synthetic NO, window 0x1800001,
    root 0x102, subw 0x0, time 154391761, (1199,664), root:(1203,689),
    state 0x10, keycode 42 (keysym 0x67, g), same_screen YES,
    XLookupString gives 1 bytes: (67) "g"
    XmbLookupString gives 1 bytes: (67) "g"
    XFilterEvent returns: False

KeyRelease event, serial 31, synthetic NO, window 0x1800001,
    root 0x102, subw 0x0, time 154391873, (1225,655), root:(1229,680),
    state 0x10, keycode 42 (keysym 0x67, g), same_screen YES,
    XLookupString gives 1 bytes: (67) "g"
    XFilterEvent returns: False

They keycode for g is 42.

On my Aspire 5020, I get the following:

  * Fn+F4 (sleep) = keycode 223
  * Fn+F8 (mute) = keycode 160
  * Fn+Home (play/ pause) = keycode 162
  * Fn+Pg Up (Stop) = keycode 164
  * Fn+Pg Down (Back) = keycode 144
  * Fn+Pg Up (Next) = keycode 153
  * Fn+Up (Volume Up) = keycode 176
  * FN+Down (Volume Down) = keycode 174

= Disclaimer =

I am not a HAL developer - I just think it's about time someone came up with a proper solution to they non-functioning keys problem, and this is the best one of the lot (it's cross distribution and cross platform, and should work out of the box, since AFAIK all distributions enable HAL by default now).